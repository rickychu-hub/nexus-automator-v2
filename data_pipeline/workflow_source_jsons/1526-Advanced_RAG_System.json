{
  "name": "RAG_Definitivo",
  "nodes": [
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.content }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "tipo",
                "value": "={{ $('If Documento es Valido').item.json.message.content }}"
              },
              {
                "name": "=resumen_documento",
                "value": "={{ $('Extraer Metadata General').item.json.output.resumen_documento }}"
              },
              {
                "name": "descripcion_documento",
                "value": "={{ $('Extraer Metadata General').item.json.output.descripcion_documento }}"
              },
              {
                "name": "analisis_documento",
                "value": "={{ $('Extraer Metadata General').item.json.output.analisis_documento }}"
              },
              {
                "name": "conclusion_documento",
                "value": "={{ $('Extraer Metadata General').item.json.output.conclusion_documento }}"
              },
              {
                "name": "keywords_documento",
                "value": "={{ $('Extraer Metadata General').item.json.output.keywords_documento }}"
              },
              {
                "name": "capitulo",
                "value": "={{ $json.chapter ?? '' }}"
              },
              {
                "name": "seccion",
                "value": "={{ $json.section ?? '' }}"
              },
              {
                "name": "articulo",
                "value": "={{ $json.article ?? '' }}"
              }
            ]
          }
        }
      },
      "id": "e0f5aaab-16ea-4335-92b3-4ac17e348029",
      "name": "Data Loader",
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "position": [
        2000,
        1900
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "mode": "insert",
        "qdrantCollection": {
          "__rl": true,
          "value": "=documentos",
          "mode": "id"
        },
        "options": {}
      },
      "id": "981a6c2b-6b95-4370-8c2a-64d4788b69f2",
      "name": "Qdrant Vector Store",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "position": [
        1980,
        1640
      ],
      "executeOnce": false,
      "retryOnFail": true,
      "typeVersion": 1,
      "credentials": {
        "qdrantApi": {
          "id": "rg2NHi83Wt2pkwYi",
          "name": "QdrantApi account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// 1) Obtiene todo el texto\nconst fullText = $('Extraer PDF').first().json.text || '';\n\n// 2) Encuentra todos los encabezados de cap칤tulo, secci칩n y art칤culo\nconst headingRegex = /^((?:CAP[I칈]TULO|SECCI[칍O]N|ART[I칈]CULO)\s+[\\w-쯒\.\\-]+)/gim;\nconst matches = [];\nlet m;\nwhile ((m = headingRegex.exec(fullText)) !== null) {\n  matches.push({\n    index: m.index,\n    header: m[1].trim()\n  });\n}\nmatches.push({ index: fullText.length, header: null });\n\n// 3) Funciones auxiliares\n// a) Extrae d칤gitos\nconst onlyDigits = str => (str.match(/\\d+/) || [''])[0];\n\n// b) Convierte romano a entero (soporta I, V, X, L, C, D, M)\nconst romanToInt = s => {\n  if (!s) return '';\n  const R = {I:1, V:5, X:10, L:50, C:100, D:500, M:1000};\n  let num = 0, prev = 0;\n  s.toUpperCase().split('').reverse().forEach(ch => {\n    const val = R[ch] || 0;\n    if (val < prev) num -= val;\n    else { num += val; prev = val; }\n  });\n  return num.toString();\n};\n\n// 4) Recorre los matches para extraer\nconst results = [];\nlet currentChapter = '';\nlet currentSection = '';\n\nfor (let i = 0; i < matches.length - 1; i++) {\n  const { index, header } = matches[i];\n  const nextIndex = matches[i + 1].index;\n  if (!header) continue;\n\n  const piece = header.match(/^(CAP[I칈]TULO|SECCI칍N|SECCION|ART[I칈]CULO)\s+(.+)$/i);\n  if (!piece) continue;\n  const [, typeRaw, numRaw] = piece;\n  const type = typeRaw.toUpperCase();\n\n  // Intentamos extraer arabigos; si no hay, caemos a romano\n  const extractNum = str => {\n    const d = onlyDigits(str);\n    if (d) return d;\n    // extraer secuencia romana (letras I,V,X,L,C,D,M)\n    const romans = (str.match(/[IVXLCDM]+/i) || [''])[0];\n    return romanToInt(romans);\n  };\n\n  if (type === 'CAP칈TULO' || type === 'CAPITULO') {\n    currentChapter = extractNum(numRaw);\n    continue;\n  }\n  if (type === 'SECCI칍N' || type === 'SECCION') {\n    currentSection = extractNum(numRaw);\n    continue;\n  }\n  if (type === 'ART칈C... [truncated]\n      ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1640,
        1640
      ],
      "id": "830661e9-5c46-4e38-97b3-031e74490aa1",
      "name": "Dividir Texto en Articulos"
    },
    {
      "parameters": {
        "model": "text-embedding-3-large",
        "options": {
          "dimensions": 1536
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1800,
        1960
      ],
      "id": "96487f35-e617-40b7-98e7-14c1c8a6756f",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "qLM5Iy3mjllZuUML",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "basicAuth",
        "formTitle": "RAG Definitivo",
        "formDescription": "=Selecciona el documento que quires cargar.\n",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Documento",
              "fieldType": "file",
              "multipleFiles": false,
              "acceptFileTypes": ".pdf",
              "requiredField": true
            }
          ]
        },
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.2,
      "position": [
        -620,
        1660
      ],
      "id": "4de551ab-27c0-4983-aaa9-ed127962dffb",
      "name": "On form submission",
      "webhookId": "7bbb414a-d50d-4f00-8984-4bb074c211fd",
      "credentials": {
        "httpBasicAuth": {
          "id": "aZpEAOV2HAMpZnnH",
          "name": "Autenticaci칩n Basica"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1260,
        1860
      ],
      "id": "7ea825bf-67e8-4c22-a6dc-4fe9d550b31b",
      "name": "Google Gemini 2.0 Flash1",
      "credentials": {
        "googlePalmApi": {
          "id": "NdyPXiyPUwmqADX5",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "Documento",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -220,
        1660
      ],
      "id": "44349fcd-d77c-4323-949f-84fa7db31033",
      "name": "Extraer PDF"
    },
    {
      "parameters": {
        "text": "={{ $('Extraer PDF').item.json.text }}",
        "attributes": {
          "attributes": [
            {
              "name": "resumen_documento",
              "description": "Resume brevemente el tipo de documento en pocas l칤neas"
            },
            {
              "name": "descripcion_documento",
              "description": "Describe brevemente el documento en pocas l칤neas."
            },
            {
              "name": "analisis_documento",
              "description": "Extrae una lista de observaciones anal칤ticas clave de la secci칩n Perspectivas anal칤ticas, incluidos los cambios de tono o comportamiento."
            },
            {
              "name": "conclusion_documento",
              "description": "Resume las conclusiones extra칤das sobre los hilos del usuario y su enfoque general."
            },
            {
              "name": "keywords_documento",
              "description": "Genere una lista de 10 palabras clave que capten la esencia del documento (por ejemplo, \"codigoPenal\", \"codigoCivil\")."
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "=Eres un experto en algoritmos de extracci칩n.\nExtrae del texto s칩lo la informaci칩n relevante.\nSi no conoces el valor de un atributo que se te pide extraer, puedes omitir el valor del atributo.\n\nDevuelve la informaci칩n en formato texto normal, no utilices markdown ni nada extra침o."
        }
      },
      "id": "7bf3375a-6f34-49e4-9dc0-c32e409efc00",
      "name": "Extraer Metadata General",
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "position": [
        1260,
        1640
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://qdrant:6333/collections/documentos/points/delete",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"filter\": {\n    \"must\": [\n      {\n        \"key\": \"metadata.tipo\",\n        \"match\": { \"value\": \"{{ $json.message.content }}\" }\n      }\n    ]\n  }\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        940,
        1640
      ],
      "id": "33a5e2c2-4ccc-4f2f-9dbe-9a042ffaecec",
      "name": "Borrar Documento Existente",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "public": true,
        "initialMessages": "Hola! 游녦\nChatea con tus documentos!",
        "options": {
          "title": "RAG Definitivo"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -300,
        4460
      ],
      "id": "e12aeee3-52c2-4be5-adaf-7e21b95ff371",
      "name": "When chat message received",
      "webhookId": "89014b9e-6604-4f91-aff9-87754349188a"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=Toma un rol de un experto en el 치mbito jur칤dico, legal y del Derecho en Espa침a.\n\nTu objetivo es responder a las consultas que te llegan del usuario. Para ello dispones de una herramienta llamada \"Conocimiento\" que tendr치s que tendr치s que usar siempre para responder a estas consultas.\n\nJam치s respondas a dudas relacionadas con leyes, normativas, o cualquier cuesti칩n del 치mbito jur칤dico y del Derecho sin antes utilizar la herramienta \"Conocimiento\".\n\nUtiliza la herramienta \"Think\" para mejorar el an치lisis de las consultas y razonar mejor las acciones a realizar. Tambi칠n te sirve para mejorar tus respuestas.\n\nFecha y hora actual: {{ $now }}",
          "maxIterations": 5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        860,
        2400
      ],
      "id": "c827d291-2dc2-4708-94bd-a2d1881b1f5c",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {
          "frequencyPenalty": 0,
          "presencePenalty": 0,
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        740,
        2660
      ],
      "id": "74d69b40-9a43-4d74-9478-5ba01dd652f5",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "qLM5Iy3mjllZuUML",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "tableName": "rag_chat"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        940,
        2680
      ],
      "id": "691ab603-9494-4432-ac6c-34fc2487a878",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "HoooGLNqE6GLB7Do",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-large",
        "options": {
          "dimensions": 1536
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1420,
        2820
      ],
      "id": "b3aeef45-fdcb-47b1-b57e-ef06aa11a62d",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "Vxp4FMoOGGm0qtkq",
          "name": "Quizpol"
        }
      }
    },
    {
      "parameters": {
        "description": "=Utiliza esta herramienta para razonar sobre las consultas que te llegan y as칤 poder ser m치s preciso con tus acciones. Tambi칠n usa esta herramienta antes de dar respuesta para asegurarte que est치s dando la respuesta correcta."
      },
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        1120,
        2660
      ],
      "id": "8583a2d0-a2ae-4b3a-b791-a29b9d29aac0",
      "name": "Think"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "Conocimiento",
        "toolDescription": "Utiliza esta herramienta para obtener el conocimiento necesario y responder a las consultas.",
        "qdrantCollection": {
          "__rl": true,
          "value": "documentos",
          "mode": "list",
          "cachedResultName": "documentos"
        },
        "topK": 10,
        "options": {
          "searchFilterJson": "{\n  \"must\": [\n    {\n      \"key\": \"metadata.articulo\",\n      \"match\": {\n        \"value\": 34\n      }\n    },\n    {\n      \"key\": \"metadata.capitulo\",\n      \"match\": {\n        \"value\": 5\n      }\n    }\n  ]\n}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.1,
      "position": [
        1320,
        2640
      ],
      "id": "1658de07-eedb-4db3-8c62-f382b4b23c71",
      "name": "Conocimiento",
      "credentials": {
        "qdrantApi": {
          "id": "rg2NHi83Wt2pkwYi",
          "name": "QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('When chat message received').item.json.chatInput }}",
        "options": {
          "systemMessage": "=Toma un rol de un experto en el 치mbito jur칤dico, legal y del Derecho en Espa침a.\n\nTu objetivo es responder a las consultas que te llegan del usuario. Para ello dispones de una herramienta llamada \"Conocimiento\" que tendr치s que tendr치s que usar siempre para responder a estas consultas.\n\nJam치s respondas a dudas relacionadas con leyes, normativas, o cualquier cuesti칩n del 치mbito jur칤dico y del Derecho sin antes utilizar la herramienta \"Conocimiento\".\n\nUtiliza la herramienta \"Think\" para mejorar el an치lisis de las consultas y razonar mejor las acciones a realizar. Tambi칠n te sirve para mejorar tus respuestas.\n\nFecha y hora actual: {{ $now }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        2820,
        3380
      ],
      "id": "02f67376-f4db-4f7b-aa76-4e2e7f6edb04",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {
          "frequencyPenalty": 0,
          "presencePenalty": 0,
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2580,
        3760
      ],
      "id": "86858456-019c-47b7-8c67-dd147d56f3f2",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "qLM5Iy3mjllZuUML",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('When chat message received').item.json.sessionId }}",
        "tableName": "rag_chat"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        2840,
        3820
      ],
      "id": "b172a003-c620-4df1-9228-589099a278fa",
      "name": "Postgres Chat Memory1",
      "credentials": {
        "postgres": {
          "id": "HoooGLNqE6GLB7Do",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-large",
        "options": {
          "dimensions": 1536
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        3280,
        3980
      ],
      "id": "c8cc0355-3af8-4f0f-8002-0bd74c047f75",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "Vxp4FMoOGGm0qtkq",
          "name": "Quizpol"
        }
      }
    },
    {
      "parameters": {
        "description": "=Utiliza esta herramienta para razonar sobre las consultas que te llegan y as칤 poder ser m치s preciso con tus acciones. Tambi칠n usa esta herramienta antes de dar respuesta para asegurarte que est치s dando la respuesta correcta."
      },
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        3060,
        3800
      ],
      "id": "f2021605-bae8-4702-82e5-f77ceebff1b1",
      "name": "Think1"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "Conomiento",
        "toolDescription": "Utiliza esta herramienta para obtener el conocimiento necesario y responder a las consultas.",
        "qdrantCollection": {
          "__rl": true,
          "value": "documentos",
          "mode": "list",
          "cachedResultName": "documentos"
        },
        "topK": 10,
        "options": {
          "searchFilterJson": "={{ JSON.stringify($json.filter) }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.1,
      "position": [
        3280,
        3760
      ],
      "id": "cdf8271f-0de8-4063-b8fb-595edcf9f363",
      "name": "Conocimiento1",
      "credentials": {
        "qdrantApi": {
          "id": "rg2NHi83Wt2pkwYi",
          "name": "QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "text": "={{ $json.chatInput }}",
        "attributes": {
          "attributes": [
            {
              "name": "articulo",
              "type": "number",
              "description": "=Tu objetivo es analizar si el texto de la entrada contiene un n칰mero de art칤culo y solo en ese caso, si existe, devolverlo en la salida exclusivamente el n칰mero.\nEs importante que identifiques que realmente se trata del n칰mero del art칤culo y no de un n칰mero de cualquier otra cosa. Si no existe, no devuelvas nada.\n\nEjemplo:\n\nEntrada: \"Estoy buscando el art칤culo 7 del c칩digo penal.\"\n\nSalida: 7\n\n\nRecordatorio:\nRecuerda que la salida siempre debe ser un n칰mero entero haciendo referencia al n칰mero del art칤culo. Nunca devuelvas nada m치s que no sea eso.\n\nTienes que ser capaz de analizar y verificar que hay un n칰mero de art칤culo. Hay ocasiones que hablan de art칤culos en el texto pero no especifican el n칰mero, y aunque en el texto haya otros n칰meros, no tienen nada que ver con el art칤culo. En estos casos la salida es vac칤a.\n\n\nProhibiciones:\nNunca devuelvas una salida con la parte decimal, solo la parte entera. \n\nEjemplo de una MALA salida: 44.9\nEjemplo de una BUENA salida: 44\n\n"
            },
            {
              "name": "capitulo",
              "type": "number",
              "description": "Tu objetivo es analizar si el texto de la entrada contiene un n칰mero de cap칤tulo y solo en ese caso, si existe, devolverlo en la salida exclusivamente el n칰mero.\nEs importante que identifiques que realmente se trata del n칰mero del cap칤tulo y no de un n칰mero de cualquier otra cosa. Si no existe, no devuelvas nada.\n\nEjemplo:\n\nEntrada: \"Estoy buscando el cap칤tulo 4 del c칩digo penal.\"\n\nSalida: 4\n\n\nRecordatorio:\nRecuerda que la salida siempre debe ser un n칰mero entero haciendo referencia al n칰mero del cap칤tulo . Nunca devuelvas nada m치s que no sea eso.\n\nTienes que ser capaz de analizar y verificar que hay un n칰mero de cap칤tulo . Hay ocasiones que hablan de art칤culos en el texto pero no especifican el n칰mero, y aunque en el texto haya otros n칰meros, no tienen nada que ver con el cap칤tulo. En estos casos la salida es vac칤a.\n\n\nProhibiciones:\nNunca devuelvas una salida con la parte decimal, solo la parte entera. \n\nEjemplo de una MALA salida: 44.9\nEjemplo de una BUENA salida: 44"
            },
            {
              "name": "tipo",
              "description": "=Tu objetivo es analizar el texto para determinar sobre qu칠 tipo de documento est치 realizando la consulta el usuario. Los documentos que haga referencia el usuario siempre ser치 del 치mbito lega: c칩dig penal, c칩digo civil, etc.\n\nEn la salida devuelve solo el nombre del documento que haga referencia, nunca jam치s devuelvas nada m치s de informaci칩n, solo el nombre.\n\nEjemplo de salida: codigo penal\n"
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "=Eres un experto jur칤dico, leyes, y 치mbito del Derecho. Tienes un rol de an치lisis de documentos legales tipo leyes y normativas. Tu objetivo es analizar si el texto de la entrada contiene los atributos que te indico para mostrarlos en la salida.\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "typeVersion": 1,
      "position": [
        40,
        4460
      ],
      "id": "de977a5d-9d6f-4032-9f71-7d13e0523615",
      "name": "Information Extractor"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {
          "frequencyPenalty": 0,
          "presencePenalty": 0,
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -40,
        4780
      ],
      "id": "e20f46d6-35f7-4374-8686-31d00d3b5c21",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "Vxp4FMoOGGm0qtkq",
          "name": "Quizpol"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4.1-nano",
          "mode": "list",
          "cachedResultName": "GPT-4.1-NANO"
        },
        "messages": {
          "values": [
            {
              "content": "=Te voy a pasar el nombre de un documento y tu objetivo es dar una de las siguientes salidas con el formato que te describo.\n\nEl nombre del documento es el siguiente: {{ $json.info.Title }}\n\nDebes clasificar con una de las siguientes opciones que te describo a continuaci칩n:\n\nley_enjuiciamiento_criminal: si el nombre del documento hace referencia a la ley de enjuiciamiento criminal.\ncodigo_penal: si el nombre del documento hace referencia al codigo penal.\nley_arrendamientos_urbanos: si el nombre del documento hace referencia a la ley de arrendamientos urbanos.\ncodigo_civil: si el nombre del documento hace referencia al codigo civil.\nley_enjuiciamento_civil: si el nombre del documento hace referencia a la ley de enjuiciamento civil.\nley_concursal: si el nombre del documento hace referencia a la ley concursal o al texto refundido de la ley concursal.\nley_ordenacion_edificacion: si el nombre del documento hace referencia a la ley de ordenacion de edificacion.\nley_juridiccion_voluntaria: si el nombre del documento hace referencia a la ley de juridiccion voluntaria.\nmateria_eficiencia_servicio_publico_justicia: si el nombre del documento hace referencia a materia de eficiencia del servicio p칰blico de justicia.\n\nTu salida siempre debe ser una de las opciones anteriores. Si no coincide, responde una salida vac칤a.\n\n\n"
            }
          ]
        },
        "options": {
          "frequency_penalty": 0,
          "presence_penalty": 0,
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        40,
        1660
      ],
      "id": "eb71c3e1-7319-422e-9495-7ff0c93a0105",
      "name": "Nombrar Documento IA",
      "credentials": {
        "openAiApi": {
          "id": "qLM5Iy3mjllZuUML",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a0ba821d-654b-4e48-b834-22e1607d2611",
              "leftValue": "={{ $json.message.content }}",
              "rightValue": "ley_enjuiciamiento_criminal",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "8a084dea-323a-415f-8fd3-705d6d94cad5",
              "leftValue": "={{ $json.message.content }}",
              "rightValue": "codigo_penal",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "58f2bb7e-480c-4bd8-81e0-79764cdcbeb5",
              "leftValue": "={{ $json.message.content }}",
              "rightValue": "ley_arrendamientos_urbanos",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "d0dd8f91-e79f-4bb1-9b42-37a4b9056f14",
              "leftValue": "={{ $json.message.content }}",
              "rightValue": "codigo_civil",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "edf02c9d-694f-4d3f-8318-cd088714d41b",
              "leftValue": "={{ $json.message.content }}",
              "rightValue": "ley_enjuiciamento_civil",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "bfebd1f4-2c33-478b-a3dd-d8fb38590f89",
              "leftValue": "={{ $json.message.content }}",
              "rightValue": "ley_concursal",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "39ee704d-f107-47fa-91fc-e417f5940a23",
              "leftValue": "={{ $json.message.content }}",
              "rightValue": "ley_ordenacion_edificacion",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "50c6da33-9e03-469b-8827-a09d96012c87",
              "leftValue": "={{ $json.message.content }}",
              "rightValue": "ley_juridiccion_voluntaria",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "8929ffb9-0deb-4bfc-b7b8-697c38e1e7b4",
              "leftValue": "={{ $json.message.content }}",
              "rightValue": "materia_eficiencia_servicio_publico_justicia",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        520,
        1660
      ],
      "id": "077ab98c-53f7-40b6-81ad-5bffcf3a3ac7",
      "name": "If Documento es Valido"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4.1-nano",
          "mode": "list",
          "cachedResultName": "GPT-4.1-NANO"
        },
        "messages": {
          "values": [
            {
              "content": "=Te voy a pasar el nombre de un documento y tu objetivo es dar una de las siguientes salidas con el formato que te describo.\n\nEl nombre del documento es el siguiente: {{ $json.output.tipo }}\n\nDebes clasificar con una de las siguientes opciones que te describo a continuaci칩n:\n\nley_enjuiciamiento_criminal: si el nombre del documento hace referencia a la ley de enjuiciamiento criminal.\ncodigo_penal: si el nombre del documento hace referencia al codigo penal.\nley_arrendamientos_urbanos: si el nombre del documento hace referencia a la ley de arrendamientos urbanos.\ncodigo_civil: si el nombre del documento hace referencia al codigo civil.\nley_enjuiciamento_civil: si el nombre del documento hace referencia a la ley de enjuiciamento civil.\nley_concursal: si el nombre del documento hace referencia a la ley concursal o al texto refundido de la ley concursal.\nley_ordenacion_edificacion: si el nombre del documento hace referencia a la ley de ordenacion de edificacion.\nley_juridiccion_voluntaria: si el nombre del documento hace referencia a la ley de juridiccion voluntaria.\nmateria_eficiencia_servicio_publico_justicia: si el nombre del documento hace referencia a materia de eficiencia del servicio p칰blico de justicia.\n\nTu salida siempre debe ser una de las opciones anteriores. Si no coincide, responde una salida vac칤a. Si est치 vac칤o, responde una salida vac칤a.\n\n\n"
            }
          ]
        },
        "options": {
          "frequency_penalty": 0,
          "presence_penalty": 0,
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        900,
        4300
      ],
      "id": "00d636bb-0516-4c78-a983-60fd36351420",
      "name": "Nombrar Documento IA1",
      "credentials": {
        "openAiApi": {
          "id": "qLM5Iy3mjllZuUML",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Funci칩n que devuelve true si la cadena est치 vac칤a o s칩lo espacios\nfunction isEmpty(str) {\n  return !str || str.trim() === '';\n}\n\n\nconst tipo = $input.first().json.tipo.toString() ?? '';\nconst capitulo = $input.first().json.capitulo.toString() ?? '';\nconst articulo = $input.first().json.articulo.toString() ?? '';\n\nvar filter;\n// Si tenemos tipo, capitulo, y articulo\nif (!isEmpty(tipo) && !isEmpty(capitulo) && !isEmpty(articulo)) {\n  filter = {\n    must: [\n      { \"key\": \"metadata.tipo\",  \"match\": { \"value\": tipo } },\n      { \"key\": \"metadata.capitulo\",  \"match\": { \"value\": capitulo } },\n      { \"key\": \"metadata.articulo\", \"match\": { \"value\": articulo } }\n    ]\n  };\n// Si solo tenemos el tipo y capitulo\n} else if (!isEmpty(tipo) && !isEmpty(capitulo) && isEmpty(articulo)) {\n  filter = {\n    must: [\n      { \"key\": \"metadata.tipo\",  \"match\": { \"value\": tipo } },\n      { \"key\": \"metadata.capitulo\",  \"match\": { \"value\": capitulo } }\n    ]\n  };\n// Si solo tenemos el tipo y articulo\n} else if (!isEmpty(tipo) && isEmpty(capitulo) && !isEmpty(articulo)) {\n   filter = {\n    must: [\n      { \"key\": \"metadata.tipo\",  \"match\": { \"value\": tipo } },\n      { \"key\": \"metadata.articulo\",  \"match\": { \"value\": articulo } }\n    ]\n  };\n// Si solo tenemos el capitulo y articulo\n} else if (isEmpty(tipo) && !isEmpty(capitulo) && !isEmpty(articulo)) {\n   filter = {\n    must: [\n      { \"key\": \"metadata.capitulo\",  \"match\": { \"value\": capitulo } },\n      { \"key\": \"metadata.articulo\",  \"match\": { \"value\": articulo } }\n    ]\n  };\n// Si solo tenemos el tipo\n} else if (!isEmpty(tipo) && isEmpty(capitulo) && isEmpty(articulo)) {\n   filter = {\n    must: [\n      { \"key\": \"metadata.tipo\",  \"match\": { \"value\": tipo } }\n    ]\n  };\n// Si solo tenemos el capitulo\n} else if (isEmpty(tipo) && !isEmpty(capitulo) && isEmpty(articulo)) {\n   filter = {\n    mus... [truncated]\n      ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1660,
        4440
      ],
      "id": "f24f211b-0729-4752-9942-3cd791969335",
      "name": "Code"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2405ec42-bdcd-4710-a115-7925f7c4f84f",
              "leftValue": "={{ $json.output.tipo }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        400,
        4460
      ],
      "id": "39848355-c9fa-47eb-a4fb-af3f765c3be6",
      "name": "If"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4d8bd9fa-60ce-4822-a333-3c09168999b4",
              "name": "tipo",
              "value": "=",
              "type": "string"
            },
            {
              "id": "45ab7bd4-76df-4454-a80c-9b28c95f721f",
              "name": "capitulo",
              "value": "={{ $('Information Extractor').item.json.output.capitulo ?? '' }}",
              "type": "string"
            },
            {
              "id": "fdd8b055-68b4-4d36-9c09-569a1d4c7eda",
              "name": "articulo",
              "value": "={{ $('Information Extractor').item.json.output.articulo ?? '' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1260,
        4580
      ],
      "id": "d8bee1e1-7435-40cc-a1a7-a8e339c96e48",
      "name": "Datos sin Tipo Documento"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4d8bd9fa-60ce-4822-a333-3c09168999b4",
              "name": "tipo",
              "value": "={{ $json.message.content ?? '' }}",
              "type": "string"
            },
            {
              "id": "45ab7bd4-76df-4454-a80c-9b28c95f721f",
              "name": "capitulo",
              "value": "={{ $('Information Extractor').item.json.output.capitulo ?? '' }}",
              "type": "string"
            },
            {
              "id": "fdd8b055-68b4-4d36-9c09-569a1d4c7eda",
              "name": "articulo",
              "value": "={{ $('Information Extractor').item.json.output.articulo ?? '' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1260,
        4300
      ],
      "id": "d8285901-ad09-43ae-b130-721510f96db9",
      "name": "Datos con Tipo Documento"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2340,
        1640
      ],
      "id": "3563fe30-ad76-4d5c-b100-f31be6b1e477",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "operation": "completion",
        "completionTitle": "춰Documento cargado!",
        "completionMessage": "El documento ha sido cargado correctamente",
        "options": {
          "formTitle": "RAG Definitivo"
        }
      },
      "type": "n8n-nodes-base.form",
      "typeVersion": 1,
      "position": [
        2560,
        1640
      ],
      "id": "bf3d0d07-5af7-4d21-9908-79c55fbed5a4",
      "name": "Form",
      "webhookId": "0471e1cf-608b-4466-b436-a3080941e2ca"
    },
    {
      "parameters": {
        "operation": "completion",
        "completionTitle": "Documento no v치lido",
        "completionMessage": "El documento introducido no es un documento v치lido.",
        "options": {
          "formTitle": "RAG Definitivo"
        }
      },
      "type": "n8n-nodes-base.form",
      "typeVersion": 1,
      "position": [
        820,
        1940
      ],
      "id": "e276c3ee-556d-4410-9dd8-a12125149ced",
      "name": "Form1",
      "webhookId": "0471e1cf-608b-4466-b436-a3080941e2ca"
    },
    {
      "parameters": {
        "mode": "load",
        "qdrantCollection": {
          "__rl": true,
          "value": "documentos",
          "mode": "list",
          "cachedResultName": "documentos"
        },
        "prompt": "={{ $('When chat message received').item.json.chatInput }}",
        "topK": 10,
        "options": {
          "searchFilterJson": "={{ JSON.stringify($json.filter) }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.1,
      "position": [
        2300,
        4460
      ],
      "id": "6a1f5a94-c170-4317-9ea1-756e35612e0d",
      "name": "Qdrant Vector Store1",
      "credentials": {
        "qdrantApi": {
          "id": "rg2NHi83Wt2pkwYi",
          "name": "QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-large",
        "options": {
          "dimensions": 1536
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2440,
        4740
      ],
      "id": "2af5f904-77e0-4791-87d9-1a2aa35779d6",
      "name": "Embeddings OpenAI3",
      "credentials": {
        "openAiApi": {
          "id": "Vxp4FMoOGGm0qtkq",
          "name": "Quizpol"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "48761f27-3fc8-441d-a312-0fa84c045a08",
              "leftValue": "={{ $json.score }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2720,
        4460
      ],
      "id": "1a69c54c-7ab2-4963-a048-fae1cba7a043",
      "name": "If1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "d1c34bc1-1e4e-4645-8f41-ccc5c10bbc66",
              "leftValue": "={{ $json.score }}",
              "rightValue": 0.5,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3020,
        4440
      ],
      "id": "c7608608-d73c-40e3-9137-477f97a7e4a2",
      "name": "If2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=1. Consulta del usuario: {{ $('When chat message received').item.json.chatInput }}\n\n2. Informaci칩n de donde obtener la respuesta: {{ $json.data }}",
        "messages": {
          "messageValues": [
            {
              "content": "=Toma un rol de un experto en el 치mbito jur칤dico, legal y del Derecho en Espa침a.\n\nTu objetivo consiste en dar respuesta a la consulta del usuario. Para ello, en la entrada tienes dos informaciones:\n\n1. Consulta del usuario: esta es la pregunta o consulta del usuario.\n\n2. Informaci칩n de donde obtener la respuesta: aqu칤 te entrego un array donde cada elemento corresponde a un trozo de informaci칩n obtenida desde una base de datos vectorial. Para darte contexto, cada elemento del array dispone de lo siguiente:\n\n\"pageContent\": hace referencia al contenido de donde extraer la informaci칩n para responder.\n\"metadata\": aqu칤 dispone de informaci칩n que da contexto al contenido, por ejemplo, art칤culo al que pertene, cap칤tulo, tipo de documento que hace referencia, resumen del documento completo.\n\nNUNCA te inventes nada si no tienes la \"Informaci칩n de donde obtener la respuesta\". Esta es la 칰nica fuente de informaci칩n. Si esto llega vac칤o, responde que no tienes informaci칩n para responder, y p칤dele que aporte m치s detalle.\n"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.6,
      "position": [
        3780,
        4420
      ],
      "id": "f0288d30-b76a-485a-8140-2c95d3c0a40e",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {
          "frequencyPenalty": 0,
          "presencePenalty": 0,
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        3760,
        4640
      ],
      "id": "22c8df52-67ff-49d9-b46c-fbd82d8a1ff7",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "qLM5Iy3mjllZuUML",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3420,
        4420
      ],
      "id": "2bed6d3e-c62a-42b7-a8c8-3bdebd36f25f",
      "name": "Aggregate1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ebb0ad17-82b0-40f6-8608-8e9cea91d29b",
              "name": "output",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4140,
        4420
      ],
      "id": "ab2b53ff-d8ee-4a34-add1-28ec04b7842b",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "chunkSize": 1024,
        "chunkOverlap": 256,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        2140,
        2120
      ],
      "id": "2839daf7-6795-4e3f-a2f8-465df6d10de2",
      "name": "Recursive Character Text Splitter"
    }
  ],
  "pinData": {},
  "connections": {
    "Data Loader": {
      "ai_document": [
        [
          {
            "node": "Qdrant Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Qdrant Vector Store": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dividir Texto en Articulos": {
      "main": [
        [
          {
            "node": "Qdrant Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Qdrant Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "On form submission": {
      "main": [
        [
          {
            "node": "Extraer PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini 2.0 Flash1": {
      "ai_languageModel": [
        [
          {
            "node": "Extraer Metadata General",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Extraer PDF": {
      "main": [
        [
          {
            "node": "Nombrar Documento IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extraer Metadata General": {
      "main": [
        [
          {
            "node": "Dividir Texto en Articulos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Borrar Documento Existente": {
      "main": [
        [
          {
            "node": "Extraer Metadata General",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Information Extractor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Conocimiento",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Conocimiento": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Conocimiento1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Think1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Conocimiento1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Information Extractor",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Information Extractor": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Nombrar Documento IA": {
      "main": [
        [
          {
            "node": "If Documento es Valido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Documento es Valido": {
      "main": [
        [
          {
            "node": "Borrar Documento Existente",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Form1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Nombrar Documento IA1": {
      "main": [
        [
          {
            "node": "Datos con Tipo Documento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Nombrar Documento IA1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Datos sin Tipo Documento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Datos sin Tipo Documento": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Datos con Tipo Documento": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Qdrant Vector Store1",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI3": {
      "ai_embedding": [
        [
          {
            "node": "Qdrant Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Qdrant Vector Store1": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "fa9c9262-7d84-456d-8fd8-1c4a2b6df5ef",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9bf9145e22226d3dde31d69a2254018e4fb1eec7eb0d3a8fb5176a27c2816db5"
  },
  "id": "xDxPIFfyoHwIO7AB",
  "tags": []
}